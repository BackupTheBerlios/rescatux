
function load_video {
  insmod vbe
  insmod vga
  insmod video_bochs
  insmod video_cirrus
}

set default="0"
set timeout=60
set theme=($root)/boot/grub/rescatux-theme.txt
if loadfont /boot/grub/unicode.pf2 ; then
  set gfxmode=640x480
  load_video
  insmod gfxterm
  terminal_output gfxterm
fi

insmod png
if background_image /boot/grub/background.png; then
  set color_normal=light-red/black
  set color_highlight=white/red
else
  set menu_color_normal=cyan/blue
  set menu_color_highlight=white/blue
fi

menuentry "Rescatux autodetect" {
  if cpuid -l ; then
    probe -s label -l $root
    label_dev=/dev/disk/by-label/$label
    iso_path=/boot/boot-isos/RESCATUX_ISO_TO_REPLACE
    export iso_path
    search --set --file $iso_path
    loopback loop $iso_path
    root=(loop)
    linux /live/vmlinuz2 boot=live config quiet fromiso=${label_dev}${iso_path}
    initrd /live/initrd2.img
  else
    probe -s label -l $root
    label_dev=/dev/disk/by-label/$label
    iso_path=/boot/boot-isos/RESCATUX_ISO_TO_REPLACE
    export iso_path
    search --set --file $iso_path
    loopback loop $iso_path
    root=(loop)
    linux /live/vmlinuz boot=live config quiet fromiso=${label_dev}${iso_path}
    initrd /live/initrd.img
  fi
}

menuentry "Super Grub2 Disk" {
  configfile /boot/grub/main.cfg
}

menuentry "Rescatux 32 bit" {
  probe -s label -l $root
  label_dev=/dev/disk/by-label/$label
  iso_path=/boot/boot-isos/RESCATUX_ISO_TO_REPLACE
  export iso_path
  search --set --file $iso_path
  loopback loop $iso_path
  root=(loop)
  linux /live/vmlinuz boot=live config quiet fromiso=${label_dev}${iso_path}
  initrd /live/initrd.img
}

menuentry "Rescatux 64 bit" {
  probe -s label -l $root
  label_dev=/dev/disk/by-label/$label
  iso_path=/boot/boot-isos/RESCATUX_ISO_TO_REPLACE
  export iso_path
  search --set --file $iso_path
  loopback loop $iso_path
  root=(loop)
  linux /live/vmlinuz2 boot=live config quiet fromiso=${label_dev}${iso_path}
  initrd /live/initrd2.img
}